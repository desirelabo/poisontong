<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>å¯†èˆŒ ã¿ã¤ã—ãŸ</title>
<style>
:root{--bg-dark:#050510;--paper:#f7f6f2;--ink:#1a1a1a;--gold:#d4af37;--glass:rgba(8,8,12,0.6);--ease:cubic-bezier(0.25,1,0.5,1)}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;outline:none;user-select:none;font-family:serif}
body{margin:0;background:var(--bg-dark);color:#e0e0e0;overflow:hidden;height:100vh;width:100vw;transition:background 1s ease-out;position:relative;touch-action:manipulation}
html,body{overflow-y:auto;height:auto;min-height:100vh}
#canvas-container{position:fixed;inset:0;z-index:1;transition:filter 1.5s,opacity 1.5s;pointer-events:none;isolation:isolate}
#canvas-container.blurred{filter:blur(15px) brightness(0.3)}
.layer{position:fixed;inset:0;z-index:100;pointer-events:none;display:flex;flex-direction:column}
#reboot-btn{position:fixed;top:20px;left:20px;z-index:8000;writing-mode:vertical-rl;text-orientation:upright;font-size:0.75rem;letter-spacing:0.3em;color:rgba(255,255,255,0.9);cursor:pointer;transition:opacity 1s;opacity:0;pointer-events:none;border:1px solid rgba(255,255,255,0.3);background:rgba(0,0,0,0.7);padding:12px 8px;min-width:44px;min-height:44px;border-radius:4px}
#reboot-btn:active{background:rgba(255,255,255,0.2);color:#fff}
#reboot-btn.active{opacity:1;pointer-events:auto}
#skip-breath-btn{position:fixed;bottom:calc(50px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%);font-size:0.75rem;letter-spacing:0.2em;color:rgba(255,255,255,0.4);cursor:pointer;border:1px solid rgba(255,255,255,0.2);padding:10px 20px;background:rgba(0,0,0,0.3);transition:opacity 0.8s;z-index:2100;opacity:0;pointer-events:none;min-height:44px;white-space:nowrap}
#skip-breath-btn.active{opacity:1;pointer-events:auto}
#skip-breath-btn:active{color:rgba(255,255,255,0.9);background:rgba(0,0,0,0.6);border-color:rgba(255,255,255,0.5)}
.flow-char{display:inline-block;opacity:0;filter:blur(8px);transform:translateY(-10px);will-change:opacity,filter,transform}
.flow-char.visible{animation:inkFlow 0.3s cubic-bezier(0.2,0.8,0.2,1) forwards}
#curtain{position:fixed;inset:0;z-index:9999;background:var(--paper);color:var(--ink);overflow:hidden;pointer-events:auto;transition:opacity 1.2s var(--ease);display:flex;align-items:center;justify-content:center;cursor:pointer;touch-action:manipulation}
#curtain::before{content:'';position:absolute;inset:0;background-image:repeating-linear-gradient(90deg,transparent,transparent 2px,rgba(0,0,0,0.01) 2px,rgba(0,0,0,0.01) 4px);animation:paperGrain 20s infinite linear;pointer-events:none}
.curtain-container{position:relative;display:flex;gap:70px;align-items:center;writing-mode:vertical-rl;text-orientation:upright;z-index:2}
.text-column{display:flex;flex-direction:column;align-items:center;gap:18px}
.app-title{font-size:3.5rem;font-weight:700;letter-spacing:0.5em;color:var(--gold);line-height:1.3;padding-right:0.5em;opacity:0;animation:fadeIn 0.8s forwards 0.3s}
.app-reading{font-size:0.85rem;letter-spacing:0.6em;color:rgba(212,175,55,0.7);padding-right:0.6em;opacity:0;animation:fadeIn 0.8s forwards 0.6s}
.divider{width:1px;height:45px;background:linear-gradient(to bottom,transparent,var(--gold),transparent);opacity:0;animation:fadeIn 0.5s forwards 0.9s}
.tagline{font-size:0.95rem;letter-spacing:0.25em;color:rgba(26,26,26,0.85);line-height:1.9;font-weight:500;opacity:0;animation:fadeIn 1.5s forwards 1.2s}
.slot-column{display:flex;flex-direction:column;align-items:center;gap:40px;margin-left:20px}
.slot-primary{width:90px;height:135px;border:2.5px solid rgba(212,175,55,0.5);border-radius:12px;background:linear-gradient(135deg,rgba(212,175,55,0.03),rgba(212,175,55,0.01));box-shadow:0 2px 8px rgba(212,175,55,0.15),inset 0 0 20px rgba(212,175,55,0.05);opacity:0;animation:slideInFromRight 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards 1.8s;position:relative}
.slot-primary::before{content:'';position:absolute;inset:8px;border:1px solid rgba(212,175,55,0.2);border-radius:8px}
.slot-secondary{width:56px;height:56px;border:2px solid rgba(212,175,55,0.4);border-radius:50%;background:radial-gradient(circle at 35% 35%,rgba(212,175,55,0.08),rgba(212,175,55,0.02));box-shadow:0 2px 6px rgba(212,175,55,0.2),inset 0 0 15px rgba(212,175,55,0.08);opacity:0;animation:slideInFromRight 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards 2.0s}
.date-display{position:fixed;bottom:30px;right:30px;writing-mode:vertical-rl;text-orientation:upright;font-size:0.65rem;letter-spacing:0.35em;color:rgba(26,26,26,0.5);opacity:0;animation:fadeIn 0.8s forwards 2.3s;z-index:3}
.tap-hint{position:fixed;bottom:35px;left:50%;transform:translateX(-50%);font-size:0.75rem;letter-spacing:0.4em;color:rgba(26,26,26,0.35);opacity:0;animation:pulseFade 2s ease-in-out infinite 2.5s;z-index:3}
.ink-fill{position:absolute;border-radius:50%;background:radial-gradient(circle,#050510 0%,#050510 70%,transparent 100%);transform:translate(-50%,-50%) scale(0);animation:inkFillAnim 2.0s cubic-bezier(0.2,1,0.2,1) forwards;z-index:30;pointer-events:none;filter:blur(2px)}
#breath-layer{z-index:2000;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 1.2s}
.breath-ring{width:150px;height:150px;border-radius:50%;border:1px solid rgba(255,255,255,0.15);box-shadow:0 0 40px rgba(255,255,255,0.05);position:absolute;opacity:0;transform:scale(0.5)}
.breath-ring.inhale{animation:ringIn 4.0s cubic-bezier(0.2,0.8,0.2,1) forwards}
.breath-ring.exhale{animation:ringOut 7.0s ease-in-out forwards}
.breath-text{font-size:1.3rem;font-weight:500;letter-spacing:0.15em;color:rgba(255,255,255,0.9);text-align:center;line-height:2;z-index:2;text-shadow:0 0 10px rgba(0,0,0,0.8);white-space:pre-line}
#ui-layer{padding:env(safe-area-inset-top) 20px calc(40px + env(safe-area-inset-bottom));justify-content:space-between;transition:opacity 1s;z-index:3000;pointer-events:none;overflow:hidden;isolation:isolate}
header{text-align:center;margin-top:20px;opacity:0;transition:opacity 2s;display:flex;flex-direction:column;align-items:center;gap:8px;flex-shrink:0}
.brand{font-size:1.1rem;letter-spacing:0.4em;color:var(--gold);opacity:0.9;font-weight:700;text-shadow:0 0 10px rgba(212,175,55,0.3)}
.brand-reading{font-size:0.55rem;letter-spacing:0.5em;color:rgba(212,175,55,0.6);opacity:0.7;margin-top:-5px}
.subtitle-header{font-size:0.65rem;letter-spacing:0.35em;color:rgba(212,175,55,0.5);opacity:0.6;margin-top:3px;font-weight:400}
.phase-tag{font-size:0.8rem;color:#888;border:1px solid #444;padding:4px 16px;border-radius:20px;opacity:0.6;margin-top:5px}
#palette-zone{width:100%;max-width:480px;margin:0 auto;opacity:0;transform:translateY(30px);transition:all 0.8s var(--ease);max-height:calc(100vh - 120px);overflow-y:auto;overflow-x:visible;-webkit-overflow-scrolling:touch;padding-bottom:env(safe-area-inset-bottom);pointer-events:auto}
.q-text{font-size:1.25rem;margin-bottom:35px;color:#fff;text-align:center;text-shadow:0 0 15px rgba(255,255,255,0.3);line-height:1.8;font-weight:500;letter-spacing:0.1em;padding:0 10px;flex-shrink:0}
.q-text .emphasis{color:var(--gold);font-size:1.4em;text-shadow:0 0 20px var(--gold);display:inline-block}
.honeycomb{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:18px;max-width:480px;padding:0 20px 150px;margin:0 auto;position:relative;z-index:10;pointer-events:auto!important}
.dot{width:48px;height:48px;border-radius:50%;position:relative;cursor:pointer;transition:transform 0.3s,box-shadow 0.3s;box-shadow:0 0 10px rgba(0,0,0,0.5),inset 0 0 10px rgba(0,0,0,0.2);animation:floatDot 4s ease-in-out infinite;flex:0 0 48px;pointer-events:auto!important;z-index:100;touch-action:none!important;will-change:transform}
.dot::after{content:'';position:absolute;inset:0;border-radius:50%;box-shadow:0 0 15px currentColor;opacity:0;transition:opacity 0.3s}
.dot:active{transform:scale(0.95);filter:brightness(1.3);box-shadow:0 0 20px currentColor}
.dot.selected{animation:dotSelected 0.3s ease-out}
.dot:nth-child(2n){animation-delay:0.5s}
.dot:nth-child(3n){animation-delay:1s}
.dot:nth-child(5n){animation-delay:1.5s}
.color-tooltip{position:absolute;top:-35px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);color:#fff;padding:5px 12px;border-radius:4px;font-size:0.75rem;letter-spacing:0.1em;white-space:nowrap;pointer-events:none;opacity:0;animation:tooltipFadeIn 0.3s forwards;z-index:1000}
.undo-btn{margin-top:30px;font-size:0.8rem;color:rgba(255,255,255,0.4);cursor:pointer;letter-spacing:0.2em;transition:color 0.3s;display:none;padding:10px 20px;min-height:44px;pointer-events:auto}
.undo-btn.active{display:block}
.undo-btn:active{color:rgba(255,255,255,0.8)}
#cinema-layer{align-items:center;justify-content:center;pointer-events:auto;z-index:4000;opacity:0;transition:opacity 2s}
#cinema-layer::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at center,var(--cinema-color,rgba(255,255,255,0.05)) 0%,transparent 50%);pointer-events:none}
.cinema-text{writing-mode:vertical-rl;text-orientation:upright;font-size:1.35rem;line-height:2.0;color:rgba(255,255,255,0.95);text-shadow:0 0 20px rgba(255,255,255,0.6);font-weight:500;letter-spacing:0.25em;text-align:justify;max-width:400px;position:relative;z-index:1}
#result-layer{background:var(--glass);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);z-index:5000;opacity:0;transform:scale(0.95);pointer-events:none;transition:opacity 0.8s ease-out,transform 0.8s ease-out,background 1s,backdrop-filter 1s;display:flex;align-items:center;justify-content:center}
#result-layer.result-enter{opacity:1;transform:scale(1);pointer-events:auto}
#result-layer.view-mode{opacity:0;transform:scale(1.05);transition:opacity 1s ease-out,transform 1s ease-out}
.result-content{writing-mode:vertical-rl;text-orientation:upright;height:75vh;width:100%;max-width:600px;display:flex;flex-direction:column;gap:2rem;align-items:center;justify-content:center;position:relative;transition:opacity 1.5s;overflow-y:auto;overflow-x:hidden;padding:0 20px}
.res-main{font-size:1.05rem;line-height:2.2;font-weight:500;letter-spacing:0.15em;color:#fff;text-shadow:0 2px 15px rgba(0,0,0,0.6);text-align:justify;opacity:1;position:absolute;top:5vh;right:8%;max-width:180px;max-height:70vh;z-index:1000;overflow-y:auto;overflow-x:hidden}
.res-main::before{content:'';position:absolute;inset:-30px;background:radial-gradient(ellipse at center,var(--yang-color,rgba(255,255,255,0.1)) 0%,transparent 80%);filter:blur(30px);z-index:-1;pointer-events:none}
.growth-text{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.15rem;color:rgba(255,255,255,0.8);letter-spacing:0.3em;text-shadow:0 0 20px rgba(255,255,255,0.5);opacity:0;transition:opacity 0.5s;z-index:8500;pointer-events:none;text-align:center}
.res-rx-container{position:absolute;top:10vh;left:5%;min-width:100px;max-width:220px;min-height:300px;cursor:pointer;transition:opacity 1.5s;z-index:100}
.rx-blur-layer{display:flex;flex-direction:column;gap:1.5rem;transition:filter 0.5s ease-out;position:relative}
.is-foggy .rx-blur-layer{filter:blur(20px);opacity:0.7}
.res-rx-line{width:1px;height:50px;background:linear-gradient(to bottom,transparent,var(--gold),transparent);opacity:0.8;margin-left:0.5rem;margin-bottom:1rem;animation:lineBreath 3s infinite ease-in-out}
.res-rx-text{font-size:1.3rem;line-height:2.7;letter-spacing:0.15em;color:#ddd;text-align:justify;font-weight:400;position:relative;z-index:100;background:linear-gradient(to bottom,rgba(245,240,230,0.05),rgba(245,240,230,0.02));padding:18px;border-left:2px solid var(--gold)}
.seal-container{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:200px;height:100vh;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:6000;opacity:0;transition:opacity 0.8s ease-out;--inner-color:#ffffff;--inner-color-dark:#cccccc;pointer-events:auto}
.seal-container.seal-enter{opacity:1}
.seal-container.seal-exit{animation:sealDissolve 0.5s ease-out forwards}
.seal-bg{position:absolute;top:0;left:50%;transform:translateX(-50%);width:200px;height:100vh;background:rgba(0,0,0,0.6);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);z-index:-1;pointer-events:none}
.crystal-seal{width:110px;height:110px;display:flex;align-items:center;justify-content:center;pointer-events:none}
.crystal-core{width:75px;height:75px;border-radius:50%;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.95),var(--inner-color) 30%,var(--inner-color-dark) 100%);box-shadow:0 0 40px var(--inner-color),0 0 60px var(--inner-color),inset 0 0 30px rgba(255,255,255,0.5),inset -10px -10px 20px rgba(0,0,0,0.3);animation:crystalPulse 3s infinite ease-in-out;position:relative}
.crystal-core::before{content:'';position:absolute;inset:-10px;border-radius:50%;background:conic-gradient(transparent 0deg,var(--inner-color) 90deg,transparent 180deg,var(--inner-color) 270deg,transparent 360deg);opacity:0.3;filter:blur(15px);animation:crystalRotate 4s infinite linear}
.seal-guide{writing-mode:vertical-rl;text-orientation:upright;font-size:1.05rem;letter-spacing:0.3em;color:#fff;margin-top:35px;white-space:nowrap;font-weight:500;text-shadow:0 0 20px rgba(0,0,0,1),0 2px 4px rgba(0,0,0,0.8);animation:crystalGuideGlow 2s infinite ease-in-out;pointer-events:none}
.seal-button{writing-mode:vertical-rl;text-orientation:upright;font-size:1.05rem;letter-spacing:0.25em;color:#fff;background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.3);padding:18px 25px;margin-top:30px;cursor:pointer;transition:all 0.3s;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);font-family:serif;white-space:nowrap;opacity:1;pointer-events:auto;position:relative;z-index:6100;min-height:60px;min-width:80px;will-change:transform}
.seal-button:active{background:rgba(255,255,255,0.3);border-color:rgba(255,255,255,0.8);color:var(--inner-color);box-shadow:0 0 20px var(--inner-color);transform:scale(0.95)}
.glass-crack{position:absolute;inset:0;pointer-events:none;z-index:6000;opacity:0}
.glass-crack path{stroke:rgba(255,255,255,0.8);stroke-width:2;fill:none;stroke-linecap:round}
#toggle-btn{position:fixed;bottom:calc(30px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%);color:rgba(255,255,255,0.5);font-size:0.8rem;letter-spacing:0.2em;cursor:pointer;border:1px solid rgba(255,255,255,0.2);padding:12px 24px;background:rgba(5,5,10,0.3);transition:opacity 0.5s;z-index:7000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);white-space:nowrap;opacity:0;pointer-events:none;min-height:48px}
#toggle-btn.active{opacity:1;pointer-events:auto}
#toggle-btn:active{color:#fff;border-color:#fff;background:rgba(5,5,10,0.6)}
#share-btn{position:fixed;bottom:calc(85px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%);font-size:0.85rem;letter-spacing:0.2em;color:rgba(255,255,255,0.9);cursor:pointer;border:1px solid rgba(212,175,55,0.5);padding:14px 30px;background:rgba(212,175,55,0.2);transition:all 0.3s;z-index:7000;opacity:0;pointer-events:none;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 2px 10px rgba(212,175,55,0.3);min-height:48px}
#share-btn.active{opacity:1;pointer-events:auto}
#share-btn:active{color:#fff;border-color:rgba(212,175,55,0.8);background:rgba(212,175,55,0.4);box-shadow:0 4px 20px rgba(212,175,55,0.5);transform:translateX(-50%) scale(0.95)}
#share-btn::before{content:'ğŸ“¤ ';font-size:1rem}
.toast{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:#fff;padding:15px 30px;border-radius:8px;font-size:0.9rem;letter-spacing:0.2em;opacity:0;pointer-events:none;z-index:11000;transition:opacity 0.3s}
.toast.show{opacity:1}
.dye-bg{position:absolute;inset:0;z-index:-1;opacity:0.2;mix-blend-mode:overlay;background-size:200% 200%;animation:gradientShift 10s ease infinite;transition:background 2s}
@keyframes fadeIn{to{opacity:1}}
@keyframes slideInFromRight{0%{opacity:0;transform:translateX(30px)}100%{opacity:1;transform:translateX(0)}}
@keyframes pulseFade{0%,100%{opacity:0.2}50%{opacity:0.6}}
@keyframes paperGrain{from{transform:translateX(0)}to{transform:translateX(100px)}}
@keyframes inkFillAnim{to{transform:translate(-50%,-50%) scale(25);opacity:1}}
@keyframes inkFlow{0%{opacity:0;filter:blur(8px);transform:translateY(-10px)}100%{opacity:1;filter:blur(0);transform:translateY(0)}}
@keyframes floatDot{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes dotSelected{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
@keyframes tooltipFadeIn{to{opacity:1}}
@keyframes ringIn{0%{transform:scale(0.2);opacity:0;border-width:1px}50%{opacity:1}100%{transform:scale(1.5);opacity:0.8;border-width:4px;border-color:rgba(255,255,255,0.8);box-shadow:0 0 50px rgba(255,255,255,0.3)}}
@keyframes ringOut{0%{transform:scale(1.5);opacity:0.8;border-color:var(--gold)}60%{opacity:0.6}100%{transform:scale(0);opacity:0;border-color:transparent}}
@keyframes lineBreath{0%,100%{opacity:0.6;box-shadow:0 0 5px var(--gold)}50%{opacity:1;box-shadow:0 0 15px var(--gold)}}
@keyframes crystalPulse{0%,100%{transform:scale(1);box-shadow:0 0 40px var(--inner-color),0 0 60px var(--inner-color),inset 0 0 30px rgba(255,255,255,0.5)}50%{transform:scale(1.1);box-shadow:0 0 60px var(--inner-color),0 0 80px var(--inner-color),inset 0 0 40px rgba(255,255,255,0.7)}}
@keyframes crystalRotate{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes crystalGuideGlow{0%,100%{opacity:0.7;text-shadow:0 0 20px rgba(0,0,0,1),0 2px 4px rgba(0,0,0,0.8)}50%{opacity:1;text-shadow:0 0 30px var(--inner-color),0 2px 4px rgba(0,0,0,0.8)}}
@keyframes sealDissolve{0%{opacity:1;transform:translate(-50%,-50%) translateY(0) scale(1)}100%{opacity:0;transform:translate(-50%,-50%) translateY(-30px) scale(0.8)}}
@keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
</style>
</head>
<body>
<button id="reboot-btn">åˆæœŸåŒ–</button>
<button id="skip-breath-btn">æ€¥ã</button>
<div id="curtain">
<div class="curtain-container">
<div class="text-column">
<div class="app-title">å¯†èˆŒ</div>
<div class="app-reading">ã¿ã¤ã—ãŸ</div>
<div class="divider"></div>
<div class="tagline">èœœã‚ˆã‚Šã‚‚ç”˜ç¾ãªã€<br>æ¯’ã¨ã„ã†åã®å‡¦æ–¹ç®‹ã€‚</div>
</div>
<div class="slot-column">
<div class="slot-primary"></div>
<div class="slot-secondary"></div>
</div>
</div>
<div class="date-display" id="date-display"></div>
<div class="tap-hint">é–‹</div>
</div>
<div id="breath-layer" class="layer">
<div class="breath-ring" id="breath-ring-1"></div>
<div class="breath-ring" id="breath-ring-2"></div>
<div class="breath-ring" id="breath-ring-3"></div>
<div class="breath-text" id="breath-txt"></div>
</div>
<div id="ui-layer" class="layer">
<header>
<div class="brand">å¯†èˆŒ</div>
<div class="brand-reading">ã¿ã¤ã—ãŸ</div>
<div class="subtitle-header">èœœã‚ˆã‚Šã‚‚ç”˜ç¾ãªã€æ¯’ã¨ã„ã†åã®å‡¦æ–¹ç®‹ã€‚</div>
<div class="phase-tag" id="phase-label">é™½ã®å„€å¼</div>
</header>
<div id="palette-zone">
<div class="q-text" id="q-text"></div>
<div class="honeycomb" id="grid"></div>
<div class="undo-btn" id="undo-btn">ã‚„ã‚Šç›´ã™</div>
</div>
</div>
<div id="cinema-layer" class="layer">
<div class="cinema-text" id="cinema-text"></div>
</div>
<div id="result-layer" class="layer">
<div class="dye-bg" id="dye-bg"></div>
<div class="result-content">
<div class="res-main" id="res-msg"></div>
<div class="res-rx-container is-foggy" id="rx-box">
<div class="rx-blur-layer">
<div class="res-rx-line"></div>
<div class="res-rx-text" id="res-rx"></div>
</div>
</div>
</div>
<div class="seal-container" id="seal-container">
<div class="seal-bg"></div>
<div class="crystal-seal">
<div class="crystal-core"></div>
</div>
<div class="seal-guide">å‡¦æ–¹ç®‹ã¸<br>ãŠé€²ã¿ãã ã•ã„</div>
<button class="seal-button" id="seal-btn">å—ã‘å–ã‚‹</button>
</div>
</div>
<div class="growth-text" id="growth-text"></div>
<svg class="glass-crack" id="glass-crack" xmlns="http://www.w3.org/2000/svg">
<path id="crack-path" d=""/>
</svg>
<div id="toggle-btn">çµæ™¶ã‚’è¦‹ã‚‹</div>
<button id="share-btn">å‡¦æ–¹ç®‹ã‚’å…±æœ‰</button>
<div class="toast" id="toast"></div>
<div id="canvas-container"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
document.addEventListener('touchstart',function(){},false);
const STORAGE_KEYS={LAST_DATE:'MS_LAST',YANG_INDEX:'MS_UIDX',YIN_INDEX:'MS_IIDX'};
const COLORS=[{c:"#d0104c",g:"FIRE",name:"ç´…è“®"},{c:"#e87a90",g:"FIRE",name:"æ¡œ"},{c:"#f08fa0",g:"FIRE",name:"çŠç‘š"},{c:"#8c161b",g:"FIRE",name:"è‘¡è„é…’"},{c:"#0e316e",g:"WATR",name:"æ·±æµ·"},{c:"#165e83",g:"WATR",name:"è—"},{c:"#38a1db",g:"WATR",name:"ç©º"},{c:"#a5deda",g:"WATR",name:"æ°´æµ…è‘±"},{c:"#004d3d",g:"LEAF",name:"æ·±ç·‘"},{c:"#1b8a68",g:"LEAF",name:"è‹¥ç«¹"},{c:"#5dac81",g:"LEAF",name:"è‹¥è‰"},{c:"#a8c97f",g:"LEAF",name:"èŒé»„"},{c:"#ffcc00",g:"VOLT",name:"é»„é‡‘"},{c:"#f7d94c",g:"VOLT",name:"æœˆå…‰"},{c:"#fac03d",g:"VOLT",name:"èœœæŸ‘"},{c:"#fb966e",g:"VOLT",name:"æ¡ƒ"},{c:"#313131",g:"SHAD",name:"å¢¨"},{c:"#5c4b24",g:"SHAD",name:"ç…¤ç«¹"},{c:"#4d5139",g:"SHAD",name:"é¶¯"},{c:"#9e3d3f",g:"SHAD",name:"è‘¡è„"},{c:"#343178",g:"NOBL",name:"ç´«ç´º"},{c:"#898ab5",g:"NOBL",name:"è—¤"},{c:"#b4a5d4",g:"NOBL",name:"æ¡”æ¢—"},{c:"#e0dedd",g:"NOBL",name:"ç™½ç·´"}];
let SHUFFLED=Array.from({length:24},(_,i)=>i).sort(()=>Math.random()-0.5);
const BREATH_TEXTS={morning:{first:"æ¯ã‚’æ•´ãˆã¦...",second:"æœã®å…‰ã‚’ã€\næ·±ãå¸ã„è¾¼ã‚“ã§...",third:"æ˜¨å¤œã®ãƒã‚¤ã‚ºã‚’ã€\nã™ã¹ã¦åãå‡ºã—ã¦..."},afternoon:{first:"æ¯ã‚’æ•´ãˆã¦...",second:"æ­£åˆã®é™å¯‚ã‚’ã€\nå¸ã„è¾¼ã‚“ã§...",third:"åˆå‰ã®ãƒã‚¤ã‚ºã‚’ã€\nã™ã¹ã¦åãå‡ºã—ã¦..."},evening:{first:"æ¯ã‚’æ•´ãˆã¦...",second:"é»„æ˜ã®ä½™éŸ»ã‚’ã€\nå¸ã„è¾¼ã‚“ã§...",third:"æ˜¼ã®ãƒã‚¤ã‚ºã‚’ã€\nã™ã¹ã¦åãå‡ºã—ã¦..."},night:{first:"æ¯ã‚’æ•´ãˆã¦...",second:"å¤œã®é™å¯‚ã‚’ã€\nå¸ã„è¾¼ã‚“ã§...",third:"ãƒã‚¤ã‚ºã‚’ã€\nã™ã¹ã¦åãå‡ºã—ã¦..."}};
const SCENARIOS={FIRE:{FIRE:"ãã®æƒ…ç†±ã¯ã€<br>ã‚‚ã†ã™ãè‡ªåˆ†è‡ªèº«ã‚’<br>ç„¼ãå°½ãã™ç‚ã€‚||ä»Šå¤œã¯ã‚¹ãƒãƒ›ã‚’ç½®ã„ã¦ã€<br>ãŠæ¹¯ã‚’æ²¸ã‹ã—ãªã•ã„ã€‚<br>ä½•ã‚‚è€ƒãˆãšã«ã¼ã‚“ã‚„ã‚Šã¨ã€‚",WATR:"æ°·ã®ä»®é¢ã®ä¸‹ã§ã€<br>ãƒã‚°ãƒãŒç…®ãˆãŸãã£ã¦ã„ã‚‹ã€‚<br>è‡ªåˆ†ãŒé¢¨é‚ªã‚’ã²ããã†ã‚ˆã€‚||èª°ã®ç›®ã‚‚æ°—ã«ã›ãšã€<br>ç†±ã„ã‚·ãƒ£ãƒ¯ãƒ¼ã§å«ã³ãªã•ã„ã€‚<br>æ„Ÿæƒ…ã®æ “ã‚’æŠœãã®ã€‚",LEAF:"ç‡ƒãˆä¸ŠãŒã‚‹å¿ƒã‚’ã€<br>ç†æ€§ã®æ£®ã§éš ãã†ã¨ã—ã¦ã„ã‚‹ã€‚<br>ç…™ãŒæ¼ã‚Œã¦ã„ã‚‹ã‚ã€‚||ã€Œå®Ÿã¯ç§ã€æ€’ã£ã¦ã‚‹ã€ã¨<br>é¡ã®è‡ªåˆ†ã«å‘Ÿã„ã¦ã€‚<br>èªã‚ã‚‹ã ã‘ã§é®ç«ã™ã‚‹ã€‚",VOLT:"èª°ã‹ã®ãŸã‚ã«<br>ç‡ƒãˆå°½ãã‚ˆã†ã¨ã—ã¦ã„ãªã„ï¼Ÿ<br>è‡ªåˆ†ã®ãŸã‚ã«ç‡ƒãˆãªã•ã„ã€‚||æ˜æ—¥ä¸€ç•ªã«ã€é«˜ã„ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’<br>è‡ªåˆ†ã®ãŸã‚ã ã‘ã«è²·ã„ãªã•ã„ã€‚<br>è‡ªåˆ†ã®èˆŒã‚’å–œã°ã›ã‚‹ã“ã¨ã€‚",SHAD:"éå»ã®æ€’ã‚ŠãŒã€<br>è…¹ã®åº•ã§ã¾ã ç‡»ã£ã¦ã„ã‚‹ã€‚<br>ä»Šå¤œã€åãå‡ºã—ãªã•ã„ã€‚||è¨±ã›ãªã„äººã®åå‰ã‚’ç´™ã«æ›¸ãã€<br>ãƒ“ãƒªãƒ“ãƒªã«ç ´ã‚Šæ¨ã¦ã‚‹ã®ã€‚<br>ç‰©ç†çš„ç ´å£ŠãŒå¿ƒã‚’æ•‘ã†ã‚ã€‚",NOBL:"ãƒ—ãƒ©ã‚¤ãƒ‰ãŒé«˜ã™ãã¦ã€<br>ç†±æƒ…ã‚’ç´ ç›´ã«å‡ºã›ãªã„ã€‚<br>å£Šã‚Œã‚„ã™ã„ã‚¬ãƒ©ã‚¹ç´°å·¥ã®å¿ƒã€‚||å¥½ããªéŸ³æ¥½ã‚’ã‹ã‘ã¦ã€<br>éƒ¨å±‹ã§ä¸€äººã§è¸Šã‚Šãªã•ã„ã€‚<br>ãã‚Œã“ãæœ¬å½“ã®æ°—é«˜ã•ã€‚"},WATR:{FIRE:"å†·é™ã•ã‚’è£…ã£ã¦ã„ã‚‹ã‘ã‚Œã©ã€<br>æœ¬å½“ã¯èª°ã‹ã«<br>ç«ã‚’ã¤ã‘ã¦ã»ã—ã„ã®ã­ã€‚||è‡ªåˆ†ã‹ã‚‰é€£çµ¡ã‚’ã—ãªã•ã„ã€‚<br>ã€ŒåŠ©ã‘ã¦ã€ã¨è¨€ãˆãªãã¦ã‚‚ã€<br>ã€Œä¼šã„ãŸã„ã€ã¯è¨€ãˆã‚‹ã¯ãšã€‚",WATR:"é€ãé€šã‚‹å­¤ç‹¬ã€‚<br>èª°ã‚‚å…¥ã‚Œãªã„åŸã§ã€<br>ä¸€äººã§éœ‡ãˆã¦ã„ã‚‹ã€‚||æ¯›å¸ƒã‚’ã‚‚ã†ä¸€æšé‡ã­ã¦ã€<br>è‡ªåˆ†ã‚’æŠ±ãã—ã‚ã¦çœ ã‚Šãªã•ã„ã€‚<br>ä½“æ¸©ã‚’æ¸©ã‚ã‚‹ã®ã¯è‡ªåˆ†ã®ä»•äº‹ã€‚",LEAF:"è€ƒãˆã‚‹ã®ã‚’ã‚„ã‚ã¦ã€<br>ãŸã æ°´ã«æµã•ã‚ŒãŸã„ã¨<br>é¡˜ã£ã¦ã„ã‚‹ã€‚||æ˜æ—¥ã¯æµã‚Œã«é€†ã‚‰ã‚ãšã€<br>æ°—åˆ†ã§è¡Œãå…ˆã‚’æ±ºã‚ãªã•ã„ã€‚<br>è¨ˆç”»ãªã‚“ã¦æ¨ã¦ã¦ã„ã„ã€‚",VOLT:"æ˜ã‚‹ãæŒ¯ã‚‹èˆã†ã»ã©ã€<br>å†…å´ã®å†·ãŸã•ãŒ<br>éš›ç«‹ã£ã¦ã—ã¾ã†ã€‚||ç„¡ç†ã«ç¬‘ã†ã®ã‚’ã‚„ã‚ã¦ã€<br>çœŸé¡”ã§ä¸€æ—¥éã”ã—ãªã•ã„ã€‚<br>æ®‹ã£ãŸäººãŒæœ¬ç‰©ã®å‘³æ–¹ã‚ˆã€‚",SHAD:"æ·±ã„æµ·ã®åº•ã§ã€<br>èª°ã«ã‚‚è¦‹ã¤ã‹ã‚‰ãªã„ã‚ˆã†ã«<br>æ³£ã„ã¦ã„ã‚‹ã€‚||æ³£ã‘ã‚‹æ˜ ç”»ã‚’ä¸€æœ¬è¦³ãªã•ã„ã€‚<br>ä»–äººã®æ‚²ã—ã¿ã‚’å€Ÿã‚Šã¦ã€<br>è‡ªåˆ†ã®æ¶™ã‚’å‡ºã—åˆ‡ã‚‹ã®ã€‚",NOBL:"è«–ç†ã§æ­¦è£…ã—ã¦ã‚‚ã€<br>ãã®å¯‚ã—ã•ã ã‘ã¯<br>éš ã›ã¦ã„ãªã„ã€‚||ç†å±ˆã˜ã‚ƒãªã„ã‚ã€‚<br>ç¾å‘³ã—ã„ã‚‚ã®ãŒé£Ÿã¹ãŸã„ã€<br>å‹•ç‰©çš„ãªæœ¬èƒ½ã«å¾“ã„ãªã•ã„ã€‚"},LEAF:{FIRE:"ç©ã‚„ã‹ãªé¡”ã‚’ã—ã¦ã€<br>å®Ÿã¯ã™ã¹ã¦ã‚’<br>ç‡ƒã‚„ã—ãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã€‚||ãƒãƒ¼ãƒˆã‚’è²·ã£ã¦ã€<br>ã€Œé»’ã„æ—¥è¨˜ã€ã‚’ã¤ã‘ãªã•ã„ã€‚<br>æ¯’ã¯å¤–ã«å‡ºã•ãªã„ã¨è…ã‚‹ã‚ã€‚",WATR:"ç™’ã‚„ã—ã‚’æ±‚ã‚ã¦ã„ã‚‹ã‚ˆã†ã§ã€<br>å®Ÿã¯ãŸã <br>é€ƒã’ãŸã„ã ã‘ã§ã—ã‚‡ã†ï¼Ÿ||é€ƒã’ã¦ã„ã„ã®ã‚ˆã€‚<br>ã‚¹ãƒãƒ›ã®é›»æºã‚’åˆ‡ã£ã¦ã€<br>çŸ¥ã‚‰ãªã„è¡—ã¸å‡ºã‹ã‘ãªã•ã„ã€‚",LEAF:"æ£®ã®ä¸­ã§çœ ã‚‹ã‚ˆã†ã«ã€<br>æ€è€ƒã‚’åœæ­¢ã•ã›ã¦ã„ã‚‹ã€‚<br>ä¼‘æ¯ã¯ã‚‚ã†ååˆ†ã‚ˆã€‚||æ–°ã—ã„é´ã‚’ãŠã‚ã—ã¦ã€<br>ã„ã¤ã‚‚ã¨é•ã†é“ã‚’æ­©ããªã•ã„ã€‚<br>å°ã•ãªå¤‰åŒ–ãŒæ™‚è¨ˆã‚’å‹•ã‹ã™ã€‚",VOLT:"ç„¡ç†ã—ã¦ç¬‘ã‚ãªãã¦ã„ã„ã€‚<br>æ¯ã‚Œè‘‰ã®ã‚ˆã†ã«<br>ä¹¾ã„ã¦ã„ã‚‹ã‚ã€‚||ãŸã£ã·ã‚Šã®åŒ–ç²§æ°´ã§<br>è‚Œã‚’æ½¤ã—ãªã•ã„ã€‚<br>å¿ƒã‚‚è½ã¡ç€ãã‚‚ã®ã‚ˆã€‚",SHAD:"æ ¹è…ã‚Œã—ãŸäººé–“é–¢ä¿‚ã‚’ã€<br>ã¾ã å¤§äº‹ã«<br>æŠ±ãˆè¾¼ã‚“ã§ã„ã‚‹ã€‚||é€£çµ¡å…ˆã‚’ä¸€ã¤æ¶ˆã—ãªã•ã„ã€‚<br>ç©ºã„ãŸã‚¹ãƒšãƒ¼ã‚¹ã«ã—ã‹ã€<br>æ–°ã—ã„é¢¨ã¯å…¥ã‚‰ãªã„ã‚ã€‚",NOBL:"é«˜å°šãªç†æƒ³ã‚’èªã‚‹å‰ã«ã€<br>ã¾ãšã¯è‡ªåˆ†ã®åœŸå°ã‚’<br>å›ºã‚ãªã•ã„ã€‚||éƒ¨å±‹ã®åºŠã‚’æ°´æ‹­ãã—ãªã•ã„ã€‚<br>è¶³å…ƒãŒç¶ºéº—ã«ãªã‚Œã°ã€<br>ç†æƒ³ã¸ã®éšæ®µãŒè¦‹ãˆã‚‹ã€‚"},VOLT:{FIRE:"ç©ºå›ã‚Šã™ã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚<br>èª°ã‚‚ã‚ãªãŸã®æœ¬å½“ã®é¡”ã‚’<br>è¦‹ã¦ã„ãªã„ã€‚||æ·±å‘¼å¸ã‚’3å›ã—ã¦ã‹ã‚‰<br>è¨€è‘‰ã‚’ç™ºã—ãªã•ã„ã€‚<br>æ²ˆé»™ã¯é›„å¼ã‚ˆã‚Šé­…åŠ›çš„ã€‚",WATR:"ãƒ”ã‚¨ãƒ­ã®ä»®é¢ã€‚<br>å®¶ã«å¸°ã£ãŸç¬é–“ã€<br>é›»æºãŒåˆ‡ã‚ŒãŸã‚ˆã†ã«å‹•ã‘ãªã„ã€‚||ç„é–¢ã§é´ã‚’è„±ãã¨ãã€<br>ã€ŒãŠç–²ã‚Œæ§˜ã€ã¨è‡ªåˆ†ã«è¨€ã£ã¦ã€‚<br>ã‚ªãƒ³ã¨ã‚ªãƒ•ã®å„€å¼ãŒå¿…è¦ã€‚",LEAF:"å…ƒæ°—ãªãµã‚Šã¯ã‚‚ã†é™ç•Œã€‚<br>å¿ƒã®å……é›»ãŒ<br>åˆ‡ã‚Œã¦ã„ã‚‹ã‚ã€‚||æ˜æ—¥ã¯ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ã‹ã‘ãšã«<br>çœ ã‚Šãªã•ã„ã€‚<br>æ™‚ã«ã¯å‹‡æ°—ã‚‚å¿…è¦ã‚ˆã€‚",VOLT:"æ‰¿èªæ¬²æ±‚ã®åŒ–ã‘ç‰©ã€‚<br>ã€Œã„ã„ã­ã€ã®æ•°ã§<br>è‡ªåˆ†ã®ä¾¡å€¤ã‚’æ¸¬ã‚‰ãªã„ã§ã€‚||SNSã‚¢ãƒ—ãƒªã‚’<br>ãƒ•ã‚©ãƒ«ãƒ€ã®å¥¥ã«éš ã—ãªã•ã„ã€‚<br>ç”»é¢ã§ãªãç©ºã‚’è¦‹ä¸Šã’ã¦ã€‚",SHAD:"æ˜ã‚‹ã„å…‰ã»ã©ã€<br>æ¿ƒã„å½±ã‚’è½ã¨ã™ã€‚<br>ãã®å½±ã«æ€¯ãˆã¦ã„ã‚‹ã®ã­ã€‚||éƒ¨å±‹ã®é›»æ°—ã‚’æ¶ˆã—ã¦ã€<br>æš—é—‡ã§5åˆ†åº§ã‚Šãªã•ã„ã€‚<br>é—‡ã‚‚å®‰ã‚‰ãã®ä¸€éƒ¨ã‚ˆã€‚",NOBL:"ç‰¹åˆ¥ã§ã‚ã‚ŠãŸã„ã¨é¡˜ã†ã»ã©ã€<br>å¹³å‡¡ãªè‡ªåˆ†ãŒ<br>è¨±ã›ãªããªã‚‹ã€‚||ã‚³ãƒ³ãƒ“ãƒ‹ã®ãŠã«ãã‚Šã‚’<br>ä¸å¯§ã«å‘³ã‚ã„ãªã•ã„ã€‚<br>å¹³å‡¡ãªæ—¥å¸¸ã«ã“ãå¹¸ç¦ãŒã‚ã‚‹ã€‚"},SHAD:{FIRE:"ãƒ‰ãƒ­ãƒ‰ãƒ­ã¨ã—ãŸåŸ·ç€ã€‚<br>ãã‚Œã‚’æ„›ã ã¨<br>å‹˜é•ã„ã—ã¦ã„ãªã„ï¼Ÿ||å¤ã„æœã‚’ä¸€ç€æ¨ã¦ãªã•ã„ã€‚<br>ãƒ¢ãƒã¸ã®åŸ·ç€ã‚’æ‰‹æ”¾ã›ã°ã€<br>äººã¸ã®åŸ·ç€ã‚‚è»½ããªã‚‹ã€‚",WATR:"èª°ã‚‚ä¿¡ã˜ã‚‰ã‚Œãªã„ã€‚<br>ç–‘ã†ã“ã¨ã§ã—ã‹<br>è‡ªåˆ†ã‚’å®ˆã‚Œãªã„ã®ã­ã€‚||æ˜æ—¥ã€èª°ã‹ä¸€äººã«<br>ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’ä¼ãˆãªã•ã„ã€‚<br>æ„Ÿè¬ã¯ç–‘å¿µã‚’æº¶ã‹ã™æ­¦å™¨ã€‚",LEAF:"è…è‘‰åœŸã®ã‚ˆã†ãªç†Ÿæˆã€‚<br>ã§ã‚‚ã€ãã‚ãã‚<br>æ–°ã—ã„èŠ½ã‚’å‡ºã•ãªã„ã¨ã€‚||èŠ±å±‹ã§ä¸€è¼ªã ã‘<br>èŠ±ã‚’è²·ã„ãªã•ã„ã€‚<br>éƒ¨å±‹ã®ç©ºæ°—ãŒå†ç”Ÿã™ã‚‹ã€‚",VOLT:"è¯ã‚„ã‹ãªä¸–ç•Œã‚’è»½è”‘ã—ãªãŒã‚‰ã€<br>æœ¬å½“ã¯ãã“ã«<br>æ†§ã‚Œã¦ã„ã‚‹ã€‚||æ†§ã‚Œã®æœã‚’<br>è©¦ç€ã—ã«è¡Œããªã•ã„ã€‚<br>æ±ºã‚ã¦ã„ã‚‹ã®ã¯è‡ªåˆ†ã ã‘ã€‚",SHAD:"æ·±æ·µã‚’è¦—ãã™ããŸã€‚<br>é—‡ã¨åŒåŒ–ã—ã¦<br>å®‰å¿ƒã—ã¦ã„ã‚‹ã‚ã­ã€‚||æœã€ã‚«ãƒ¼ãƒ†ãƒ³ã‚’é–‹ã‘ã¦<br>æ—¥å…‰ã‚’æµ´ã³ãªã•ã„ã€‚<br>ã‚ãªãŸã«ã¯å…‰ãŒå¿…è¦ã‚ˆã€‚",NOBL:"å­¤ç‹¬ã®ç‹æ§˜ã€‚<br>èª°ã‚‚ç†è§£ã—ã¦ãã‚Œãªã„ã¨<br>å˜†ãã®ã¯ãŠã—ã¾ã„ã€‚||è‡ªåˆ†ã®å¼±ã¿ã‚’ä¸€ã¤ã€<br>èª°ã‹ã«è©±ã—ã¦ã¿ãªã•ã„ã€‚<br>ä¸å®Œå…¨ãªæ–¹ãŒæ„›ã•ã‚Œã‚‹ã€‚"},NOBL:{FIRE:"é«˜è²´ãªãƒ—ãƒ©ã‚¤ãƒ‰ãŒã€<br>æƒ…ç†±ã®é‚ªé­”ã‚’ã—ã¦ã„ã‚‹ã€‚<br>ç´ ç›´ã«ãªã‚Šãªã•ã„ã€‚||ã‚³ãƒ¡ãƒ‡ã‚£æ˜ ç”»ã‚’è¦‹ã¦ã€<br>ãŠè…¹ã‚’æŠ±ãˆã¦ç¬‘ã„ãªã•ã„ã€‚<br>ç¬‘ã„ã¯è‡ªæ„è­˜ã‚’ç •ãã€‚",WATR:"ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãªå¥³ã‚’æ¼”ã˜ã‚‹ã®ã¯ã€<br>ç©ºã£ã½ãªè‡ªåˆ†ã‚’<br>éš ã™ãŸã‚ï¼Ÿ||æ—¥è¨˜ã‚’ã¤ã‘ãªã•ã„ã€‚<br>èª°ã«è¦‹ã›ã‚‹ãŸã‚ã§ã‚‚ãªãã€<br>è‡ªåˆ†ã®ç©ºæ´ã‚’åŸ‹ã‚ã‚‹ã®ã€‚",LEAF:"ç¾å®Ÿé€ƒé¿ã®å¤¢æƒ³å®¶ã€‚<br>åœ°ã«è¶³ã‚’ã¤ã‘ã¦<br>ç”Ÿããªã•ã„ã€‚||æ–™ç†ã‚’ã—ãªã•ã„ã€‚<br>é‡èœã‚’åˆ‡ã‚Šã€ç«ã‚’é€šã™ã€‚<br>ç¾å®Ÿã«å¼•ãæˆ»ã™ä½œæ¥­ã‚’ã€‚",VOLT:"å“ä½ã‚’ä¿ã¨ã†ã¨ã—ã¦ã€<br>æ³¥è‡­ã„åŠªåŠ›ã‚’<br>ç¬‘ã£ã¦ã„ã‚‹ã§ã—ã‚‡ã†ã€‚||éšæ®µã‚’ä½¿ã„ãªã•ã„ã€‚<br>æ±—ã‚’ã‹ãã€æ¯ã‚’åˆ‡ã‚‰ã™ã€‚<br>ç”Ÿãã‚‹ã¯æœ¬æ¥æ³¥è‡­ã„ã€‚",SHAD:"é¸ã°ã‚ŒãŸäººé–“ã ã¨æ€ã„ãŸã„ã€‚<br>ãã®å‚²æ…¢ã•ãŒ<br>å­¤ç‹¬ã®æ­£ä½“ã‚ˆã€‚||é“ç«¯ã®æƒé™¤ã‚’ã—ãªã•ã„ã€‚<br>èª°ã‚‚è¦‹ã¦ã„ãªã„å¾³ã‚’ç©ã‚ã°ã€<br>æœ¬ç‰©ã®å“æ ¼ãŒå®¿ã‚‹ã€‚",NOBL:"ç´«ç…™ã®ä¸­ã«é€ƒã’ã¦ã‚‚ã€<br>æœã¯å¿…ãšæ¥ã‚‹ã€‚<br>ç›®ã‚’è¦šã¾ã—ã¦ã€‚||æœä¸€ç•ªã«å†·ãŸã„æ°´ã‚’<br>ä¸€æ¯é£²ã¿ãªã•ã„ã€‚<br>ä¸–ç•Œã¯ã‚‚ã£ã¨é®®ã‚„ã‹ã«è¦‹ãˆã‚‹ã€‚"}};
const CHAR_DELAYS={'ã€‚':400,'ã€':200,'ï¼Ÿ':350,'ï¼':350,'â€¦':300,'ã€€':100,'\n':150};
const DEFAULT_DELAY=60;
let breathTimeouts=[];
let lastTouchTime=0;
let state={phase:'INIT',uIdx:-1,iIdx:-1};
let currentRxText='';
let scene,camera,renderer,shell,core,stars,pointLight;
let targetY=1.2,targetZ=12;
let mouseX=0,mouseY=0;
let isViewMode=false;

function getTimeOfDay(){
const hour=new Date().getHours();
if(hour>=5&&hour<12)return'morning';
if(hour>=12&&hour<17)return'afternoon';
if(hour>=17&&hour<21)return'evening';
return'night'
}

function showToast(message){
const toast=document.getElementById('toast');
toast.textContent=message;
toast.classList.add('show');
setTimeout(()=>{toast.classList.remove('show')},2000)
}

function toFullKanji(year,month,day){
const digits=['ã€‡','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
const convertNumber=(num)=>String(num).split('').map(d=>digits[parseInt(d)]).join('');
const kanjiMonths=['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å','åä¸€','åäºŒ'];
const kanjiDays=[...Array(31)].map((_,i)=>{
const n=i+1;
if(n===10)return'å';
if(n===20)return'äºŒå';
if(n===30)return'ä¸‰å';
if(n<10)return digits[n];
const tens=Math.floor(n/10);
const ones=n%10;
return(tens>1?digits[tens]:'')+'å'+(ones>0?digits[ones]:'')
});
return convertNumber(year) + 'å¹´' + kanjiMonths[month-1] + 'æœˆ' + kanjiDays[day-1] + 'æ—¥';
}

function updateDateTime(){
const date=new Date();
document.getElementById('date-display').textContent=toFullKanji(date.getFullYear(),date.getMonth()+1,date.getDate())
}

function flowText(element,text,callback){
element.innerHTML='';
const lines=text.split('<br>'),container=document.createElement('div');
container.style.display='inline';
let totalDelay=0;
lines.forEach((line,lineIdx)=>{
if(lineIdx>0)container.appendChild(document.createElement('br'));
line.split('').forEach((char)=>{
if(char==='\n'){container.appendChild(document.createElement('br'));return}
if(char==='')return;
const span=document.createElement('span');
span.className='flow-char';
span.textContent=char;
container.appendChild(span);
setTimeout(()=>{span.classList.add('visible')},totalDelay);
totalDelay+=CHAR_DELAYS[char]||DEFAULT_DELAY
})
});
element.appendChild(container);
if(callback)setTimeout(callback,totalDelay+500)
}

function darkenColor(hex,percent){
const num=parseInt(hex.replace('#',''),16),amt=Math.round(2.55*percent),R=Math.max((num>>16)-amt,0),G=Math.max((num>>8&0x00FF)-amt,0),B=Math.max((num&0x0000FF)-amt,0);
return'#'+(0x1000000+R*0x10000+G*0x100+B).toString(16).slice(1)
}

function getCurrentScenario(){
return SCENARIOS[COLORS[state.uIdx].g][COLORS[state.iIdx].g]
}

function getSelectedColors(){
return{
yang:COLORS[state.uIdx],
yin:COLORS[state.iIdx],
yangName:COLORS[state.uIdx].name,
yinName:COLORS[state.iIdx].name,
yangColor:COLORS[state.uIdx].c,
yinColor:COLORS[state.iIdx].c
}
}

function reboot(){
console.log('[reboot] Called');
if(confirm("è¨˜éŒ²ã‚’æ¶ˆã—ã¦ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")){
localStorage.removeItem(STORAGE_KEYS.LAST_DATE);
localStorage.removeItem(STORAGE_KEYS.YANG_INDEX);
localStorage.removeItem(STORAGE_KEYS.YIN_INDEX);
window.location.href=window.location.pathname+'?reboot='+Date.now()
}
}

function skipBreath(){
console.log('[skipBreath] Called');
breathTimeouts.forEach(t=>clearTimeout(t));
breathTimeouts=[];
const bl=document.getElementById('breath-layer'),skipBtn=document.getElementById('skip-breath-btn');
bl.style.opacity='0';
bl.style.transition='opacity 0.3s';
skipBtn.classList.remove('active');
setTimeout(()=>{
bl.style.display='none';
setupYang()
},300)
}

function undoSelection(){
console.log('[undoSelection] Called, phase:',state.phase);
if(state.phase==='YIN'){
state.phase='INIT';
document.querySelectorAll('.dot').forEach(d=>d.classList.remove('selected'));
document.getElementById('undo-btn').classList.remove('active')
}
}

function setupYang(){
console.log('[setupYang] Called');
document.body.style.background="radial-gradient(circle at 50% 40%, #2a2c39 0%, #101015 90%)";
document.getElementById('canvas-container').classList.add('blurred');
const ui=document.getElementById('ui-layer'),pz=document.getElementById('palette-zone');
ui.style.pointerEvents='auto';
document.querySelector('header').style.opacity='1';
ui.style.opacity='1';
pz.style.opacity='1';
pz.style.transform='translateY(0)';
const qtext=document.getElementById('q-text');
qtext.innerHTML='ä¸–ç•Œã¨å¯¾å³™ã™ã‚‹ãŸã‚ã®ã€<br><span class="emphasis">é§ï¼ˆã‚ˆã‚ã„ï¼‰</span>ã¯ä½•è‰²ï¼Ÿ';
buildPalette();
setTimeout(()=>{
pz.style.pointerEvents='auto';
document.getElementById('grid').style.pointerEvents='auto';
console.log('[setupYang] Palette ready')
},500)
}

function buildPalette(){
console.log('[buildPalette] Called');
const g=document.getElementById('grid');
g.innerHTML='';

SHUFFLED.forEach((idx)=>{
const obj=COLORS[idx];
const d=document.createElement('div');
d.className='dot';
d.style.background=obj.c;
d.style.color=obj.c;
d.dataset.idx=idx;

d.onclick=function(e){
e.preventDefault();
e.stopPropagation();
const dotIdx=parseInt(this.dataset.idx);
console.log('[Dot click]',COLORS[dotIdx].name,'phase:',state.phase);

if(Date.now()-lastTouchTime<500){
console.log('Click ignored (recent touch)');
return
}

if(state.phase==='INIT'){
handleYang(dotIdx,this)
}else if(state.phase==='YIN'){
handleYin(dotIdx,this)
}
};

d.ontouchend=function(e){
e.preventDefault();
e.stopPropagation();
lastTouchTime=Date.now();

const touch=e.changedTouches[0];
const element=document.elementFromPoint(touch.clientX,touch.clientY);
const dot=element?.closest('.dot');

if(!dot){
console.log('[touchend] No dot found');
return
}

const dotIdx=parseInt(dot.dataset.idx);
console.log('[Dot touchend]',COLORS[dotIdx].name,'phase:',state.phase);

if(state.phase==='INIT'){
handleYang(dotIdx,dot)
}else if(state.phase==='YIN'){
handleYin(dotIdx,dot)
}
};

g.appendChild(d)
});

console.log('[buildPalette] Created',document.querySelectorAll('.dot').length,'dots')
}

function rippleEffect(target){
const dots=document.querySelectorAll('.dot'),targetRect=target.getBoundingClientRect(),targetX=targetRect.left+targetRect.width/2,targetY=targetRect.top+targetRect.height/2;
dots.forEach((d)=>{
if(d!==target){
const dRect=d.getBoundingClientRect(),dX=dRect.left+dRect.width/2,dY=dRect.top+dRect.height/2,distance=Math.hypot(dX-targetX,dY-targetY),delay=distance*0.5;
setTimeout(()=>{
d.style.transform='scale(0.95)';
setTimeout(()=>{d.style.transform='scale(1)'},100)
},delay)
}
})
}

function handleYang(idx,target){
console.log('[handleYang] Called',{idx:idx,phase:state.phase,color:COLORS[idx].name});
if(state.phase!=='INIT'){
console.log('[handleYang] Wrong phase, aborting');
return
}
state.uIdx=idx;
state.phase='YIN';
rippleEffect(target);
document.querySelectorAll('.dot').forEach(d=>d.classList.remove('selected'));
target.classList.add('selected');
document.getElementById('undo-btn').classList.add('active');
document.body.style.background="#000000";
const pz=document.getElementById('palette-zone');
pz.style.opacity='0';
setTimeout(()=>{
document.getElementById('phase-label').innerText="é™°ã®å„€å¼";
const qtext=document.getElementById('q-text');
qtext.innerHTML='ãã®äº€è£‚ã‹ã‚‰æ¼ã‚Œå‡ºã—ã¦ã„ã‚‹ã€<br><span class="emphasis">ç†±ï¼ˆæœ¬éŸ³ï¼‰</span>ã¯ä½•è‰²ï¼Ÿ';
buildPalette();
pz.style.opacity='1';
pz.scrollTop=0;
document.getElementById('undo-btn').classList.remove('active')
},1000)
}

function handleYin(idx,target){
console.log('[handleYin] Called',{idx:idx,phase:state.phase,color:COLORS[idx].name});
if(state.phase!=='YIN'){
console.log('[handleYin] Wrong phase, aborting');
return
}
state.iIdx=idx;
state.phase='DONE';
rippleEffect(target);
document.querySelectorAll('.dot').forEach(d=>d.classList.remove('selected'));
target.classList.add('selected');
document.getElementById('ui-layer').style.opacity='0';
document.getElementById('ui-layer').style.pointerEvents='none';
setTimeout(()=>{
document.getElementById('ui-layer').style.display='none'
},1000);
performCrystalGrowth()
}

function performCrystalGrowth(){
console.log('[performCrystalGrowth] Start');
state.phase='CRYSTAL_GROW';
const canvas=document.getElementById('canvas-container');
canvas.classList.remove('blurred');
canvas.style.filter='';
document.body.style.background='#000';
targetY=0;
let startTime=Date.now();
function growCrystal(){
if(state.phase!=='CRYSTAL_GROW')return;
let elapsed=(Date.now()-startTime)/3000,progress=Math.min(elapsed,1);
if(progress<1){
requestAnimationFrame(growCrystal)
}else{
state.phase='RESULT';
targetZ=8.5;
localStorage.setItem(STORAGE_KEYS.LAST_DATE,new Date().toDateString());
localStorage.setItem(STORAGE_KEYS.YANG_INDEX,state.uIdx);
localStorage.setItem(STORAGE_KEYS.YIN_INDEX,state.iIdx);
startCinemaTransition()
}
}
growCrystal()
}

function startCinemaTransition(){
  console.log('[startCinemaTransition] Start');
  setTimeout(()=>{
    const scenario=getCurrentScenario();
    const[main,rx]=scenario.split('||');
    const firstSentence=main.split('ã€‚')[0]+'ã€‚';
    const cinemaLayer=document.getElementById('cinema-layer'),cinemaText=document.getElementById('cinema-text');
    cinemaLayer.style.setProperty('--cinema-color',`${COLORS[state.iIdx].c}33`);
    cinemaLayer.style.opacity='1';
    flowText(cinemaText,firstSentence,()=>{
      setTimeout(()=>{
        cinemaLayer.style.opacity='0';
        setTimeout(()=>{showResult(scenario)},1000)
      },2000)
    })
  },1000);

  document.getElementById('cinema-layer').addEventListener('click',()=>{
    const cinemaLayer=document.getElementById('cinema-layer');
    if(cinemaLayer.style.opacity==='1'){
      cinemaLayer.style.opacity='0';
      const scenario=getCurrentScenario();
      setTimeout(()=>{showResult(scenario)},500)
    }
  },{once:true});
}


function showResult(raw){
console.log('[showResult] Start');
const rl=document.getElementById('result-layer'),colors=getSelectedColors();
document.getElementById('dye-bg').style.background=`linear-gradient(135deg, ${colors.yangColor}, ${colors.yinColor})`;
rl.style.background='var(--glass)';
rl.style.setProperty('--yang-color',`${colors.yangColor}33`);
setTimeout(()=>{rl.classList.add('result-enter')},100);
let[main,rx]=raw.split('||');
const mainEl=document.getElementById('res-msg'),rxEl=document.getElementById('res-rx');
flowText(mainEl,main,()=>{
setTimeout(()=>{
showSeal(colors.yinColor,darkenColor(colors.yinColor,40))
},2000)
});
rxEl.innerHTML='';
rxEl.style.minHeight='300px';
currentRxText=rx
}

function showSeal(color,darkColor){
console.log('[showSeal] Start');
const sealContainer=document.getElementById('seal-container'),sealBtn=document.getElementById('seal-btn');
sealContainer.style.setProperty('--inner-color',color);
sealContainer.style.setProperty('--inner-color-dark',darkColor);
sealBtn.style.pointerEvents='auto';
sealContainer.style.display='flex';
setTimeout(()=>{sealContainer.classList.add('seal-enter')},50);
setTimeout(()=>{document.getElementById('reboot-btn').classList.add('active')},500)
}

function createGlassCrack(){
const svg=document.getElementById('glass-crack'),path=document.getElementById('crack-path'),centerX=window.innerWidth/2,centerY=window.innerHeight/2;
let pathData=`M ${centerX} ${centerY} `;
for(let i=0;i<8;i++){
const angle=(Math.PI*2/8)*i+Math.random()*0.5,length=100+Math.random()*200,endX=centerX+Math.cos(angle)*length,endY=centerY+Math.sin(angle)*length;
pathData+=`L ${endX} ${endY} M ${centerX} ${centerY} `
}
path.setAttribute('d',pathData);
svg.style.opacity='1';
setTimeout(()=>{svg.style.opacity='0'},300)
}

function revealRx(){
console.log('[revealRx] Start');
createGlassCrack();
const rxBox=document.getElementById('rx-box'),rxEl=document.getElementById('res-rx'),sealContainer=document.getElementById('seal-container'),sealBtn=document.getElementById('seal-btn');
sealBtn.style.opacity='0';
sealBtn.style.transform='translateY(-20px)';
sealContainer.classList.remove('seal-enter');
sealContainer.classList.add('seal-exit');
rxBox.classList.remove('is-foggy');
setTimeout(()=>{
sealContainer.style.display='none';
const scenario=getCurrentScenario(),rx=scenario.split('||')[1];
flowText(rxEl,rx);
document.getElementById('toggle-btn').classList.add('active');
document.getElementById('share-btn').classList.add('active')
},500)
}

function generateShareText(){
const scenario=getCurrentScenario(),[diagnosis,prescription]=scenario.split('||'),diagnosisText=diagnosis.replace(/<br>/g,'\n'),prescriptionText=prescription.replace(/<br>/g,'\n'),colors=getSelectedColors();
return`ğŸŒ™ å¯†èˆŒ - ä»Šæ—¥ã®å‡¦æ–¹ç®‹

ã€è¨ºæ–­ã€‘
${diagnosisText}

ã€å‡¦æ–¹ã€‘
${prescriptionText}

ğŸ¨ ${colors.yangName} Ã— ${colors.yinName}

èœœã‚ˆã‚Šã‚‚ç”˜ç¾ãªã€æ¯’ã¨ã„ã†åã®å‡¦æ–¹ç®‹
https://www.gay4.me/poisontong/`
}

function fallbackShare(text){
if(navigator.clipboard){
navigator.clipboard.writeText(text).then(()=>showToast('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')).catch(()=>fallbackCopy(text))
}else{
fallbackCopy(text)
}
}

function fallbackCopy(text){
const textarea=document.createElement('textarea');
textarea.value=text;
textarea.style.position='fixed';
textarea.style.opacity='0';
document.body.appendChild(textarea);
textarea.select();
try{
document.execCommand('copy');
showToast('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')
}catch(e){
showToast('ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸ')
}
document.body.removeChild(textarea)
}

function toggleViewMode(){
console.log('[toggleViewMode] Called');
const rl=document.getElementById('result-layer'),btn=document.getElementById('toggle-btn'),shareBtn=document.getElementById('share-btn'),canvas=document.getElementById('canvas-container');
if(!isViewMode){
targetZ=6;
rl.classList.add('view-mode');
rl.addEventListener('transitionend',function hideLayer(){
if(isViewMode)rl.style.display='none';
rl.removeEventListener('transitionend',hideLayer)
});
btn.innerText="å‡¦æ–¹ç®‹ã‚’èª­ã‚€";
shareBtn.classList.remove('active');
canvas.style.filter='none';
canvas.classList.remove('blurred');
isViewMode=true
}else{
targetZ=8.5;
rl.style.display='flex';
requestAnimationFrame(()=>{rl.classList.remove('view-mode')});
btn.innerText="çµæ™¶ã‚’è¦‹ã‚‹";
shareBtn.classList.add('active');
isViewMode=false
}
}

function shareRx(){
console.log('[shareRx] Called');
const shareText=generateShareText(),isMobileDevice=/Android|iPhone|iPad/i.test(navigator.userAgent);
if(isMobileDevice&&navigator.share){
navigator.share({title:'å¯†èˆŒ',text:shareText}).then(()=>{}).catch((e)=>{
if(e.name!=='AbortError')fallbackShare(shareText)
})
}else{
fallbackShare(shareText)
}
}

function startBreath(){
console.log('[startBreath] Called');
const bl=document.getElementById('breath-layer'),rings=[document.getElementById('breath-ring-1'),document.getElementById('breath-ring-2'),document.getElementById('breath-ring-3')],txt=document.getElementById('breath-txt'),skipBtn=document.getElementById('skip-breath-btn');
const timeOfDay=getTimeOfDay(),texts=BREATH_TEXTS[timeOfDay];
breathTimeouts=[];
flowText(txt,texts.first);
document.body.style.background='#000000';
breathTimeouts.push(setTimeout(()=>{skipBtn.classList.add('active')},2000));
breathTimeouts.push(setTimeout(()=>{
flowText(txt,texts.second);
rings.forEach((ring,i)=>{
breathTimeouts.push(setTimeout(()=>{ring.classList.add('inhale')},i*800))
})
},2300));
breathTimeouts.push(setTimeout(()=>{
flowText(txt,texts.third);
rings.forEach((ring)=>{
ring.classList.remove('inhale');
ring.classList.add('exhale')
});
document.body.style.background='#0a0a0f'
},6300));
breathTimeouts.push(setTimeout(()=>{
bl.style.opacity='0';
skipBtn.classList.remove('active');
breathTimeouts.push(setTimeout(()=>{bl.style.display='none'},1000));
setupYang()
},11800))
}

document.getElementById('reboot-btn').onclick=reboot;
document.getElementById('skip-breath-btn').onclick=skipBreath;
document.getElementById('undo-btn').onclick=undoSelection;
document.getElementById('toggle-btn').onclick=toggleViewMode;
document.getElementById('share-btn').onclick=shareRx;
document.getElementById('seal-btn').onclick=revealRx;
document.getElementById('curtain').onclick=function(){
console.log('[curtain] Clicked');
const curtain=this;
const bl=document.getElementById('breath-layer');
bl.style.opacity='0.3';
setTimeout(()=>{curtain.style.opacity='0'},500);
const ripple=document.createElement('div');
ripple.className='ink-fill';
let x=window.innerWidth/2,y=window.innerHeight/2;
ripple.style.left=`${x}px`;
ripple.style.top=`${y}px`;
ripple.style.width='200px';
ripple.style.height='200px';
curtain.appendChild(ripple);
setTimeout(()=>{curtain.style.display='none'},1800);
setTimeout(()=>{
bl.style.opacity='1';
startBreath()
},2000)
};

window.addEventListener('DOMContentLoaded',()=>{
console.log('[DOMContentLoaded] Start');
updateDateTime();
const urlParams=new URLSearchParams(window.location.search);
if(urlParams.has('reboot')){return}
const last=localStorage.getItem(STORAGE_KEYS.LAST_DATE),today=new Date().toDateString();
if(last===today){
state.uIdx=parseInt(localStorage.getItem(STORAGE_KEYS.YANG_INDEX));
state.iIdx=parseInt(localStorage.getItem(STORAGE_KEYS.YIN_INDEX));
document.getElementById('curtain').style.display='none';
document.getElementById('reboot-btn').classList.add('active');
const scenario=getCurrentScenario();
showResult(scenario);
setTimeout(()=>{revealRx()},100)
}
console.log('[DOMContentLoaded] Complete')
});
</script>
</body>
</html>
